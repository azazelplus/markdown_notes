# pythonè¯­æ³•å’Œæ•°æ®ç»“æ„

### tuple & list & mapsto

()å†…çš„æ˜¯tuple. []å†…çš„æ˜¯list. {}å†…çš„æ˜¯map.
tupleå’Œlistå¯ä»¥ç›¸äº’è½¬åŒ–. åæ­£éƒ½æ˜¯åˆ—è¡¨, å‰è€…ä¸å¯å˜è€Œå·².
è¡¨ç¤ºtensorçš„shapeçš„æ—¶å€™, å¯ä»¥ç”¨tupleä¹Ÿå¯ä»¥ç”¨list: è¿™ä¸ªtuple/listçš„æ¯ä¸€ç»´æ•°å­—è¡¨ç¤ºtensorçš„ä¸€ä¸ªè§’æ ‡çš„å–å€¼.(è§pytorchç« èŠ‚çš„tensor)

æ¯”å¦‚ä½¿ç”¨å·¥å‚å‡½æ•°new_ones()æ—¶:
x.new_ones([8, ])è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªä¸€ç»´çš„åˆ†é‡ä¸º8çš„æ¯ä¸ªå€¼éƒ½æ˜¯1çš„tensor. å®ƒæ¥è‡ªtensor`x`, æ„å‘³ç€å®ƒçš„æ•°æ®ç±»å‹å’Œè®¾å¤‡éƒ½å’Œ`x`ç›¸åŒ.

`8, ]`è¡¨ç¤ºä¸€ä¸ªåˆ—è¡¨, åªæœ‰`8`è¿™ä¸€ä¸ªå…ƒç´ .

`[x_T.shape[0], ]`è¡¨ç¤ºä¸€ä¸ªåˆ—è¡¨, åªæœ‰`x_T.shape[0]`è¿™ä¸€ä¸ªå…ƒç´ .


### with ä¸Šä¸‹æ–‡ç®¡ç†å™¨
withè¯­å¥ç”¨äºåˆ›å»ºä¸€ä¸ª**ä¸Šä¸‹æ–‡ç®¡ç†å™¨**:
```python
with expression as variable:
    #ä½¿ç”¨ variableè¿›è¡Œä¸€äº›æ“ä½œ
    ...
```

æœ€å¸¸è§çš„ç”¨æ³•æ˜¯å¤„ç†æ–‡ä»¶æ“ä½œ, ä¾‹å¦‚:
```python
with open("myfile.txt","w") as file:
    file.write("hello,world!")#è¿™ä¸€å¥è¯å³withè¯­å¥å—.

#open("myfile.txt","w")è¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡, æ–¹å¼ä¸ºwritableå¯ä¿®æ”¹. wæ¨¡å¼ä¸‹, å¦‚æœå½“å‰ç›®å½•ä¸­æ²¡æœ‰è¯¥åå­—çš„æ–‡ä»¶, ä¼šåˆ›å»ºä¸€ä¸ªæ–°ç©ºæ–‡ä»¶, å¹¶ä¸”å°†å…¶è¿”å›.
#with å°†è¿™ä¸ªæ–‡ä»¶å¯¹è±¡èµ‹ç»™å˜é‡åfile, æ‰§è¡Œè¯­å¥å—å, åˆ é™¤è¿™ä¸ªå˜é‡å, å¾ˆç®€æ´.
#å½“withè¯­å¥å—ç»“æŸæ—¶, æ–‡ä»¶å¯¹è±¡ä¼šè‡ªåŠ¨å…³é—­, æ— éœ€æ˜¾å¼è°ƒç”¨file.close().
```


å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨. åŸç†ä¸Š, åªè¦èƒ½å®ç°**æ‰“å¼€æ–‡ä»¶**å’Œ**é€€å‡ºæ–‡ä»¶**ä¸¤ä¸ª**æ–¹æ³•**å³æˆä¸ºäº†ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨.
```python
class MyContextManager:
    def __enter__(self):
        print("entering the context")
        return self

    def __exit__(self. exc_type, exc_value, traceback):
        print("exiting the context")

with MyContextManager() as manager:
    print("inside the contest")

```


### f-string
è¿™æ˜¯ Python ä¸­çš„ä¸€ç§å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹å¼ï¼Œç§°ä¸º f-string æˆ– æ ¼å¼åŒ–å­—ç¬¦ä¸²å­—é¢é‡ã€‚å®ƒåœ¨ Python 3.6 ä¸­å¼•å…¥ï¼Œç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥è¡¨è¾¾å¼ï¼Œä½¿å¾—å­—ç¬¦ä¸²æ ¼å¼åŒ–æ›´åŠ ç®€æ´å’Œç›´è§‚ã€‚

#### f-string çš„ä½œç”¨:
- æ’å€¼: f-string å…è®¸åœ¨å­—ç¬¦ä¸²ä¸­ç›´æ¥åµŒå…¥å˜é‡æˆ–è¡¨è¾¾å¼ï¼Œå¹¶è‡ªåŠ¨æ ¼å¼åŒ–å®ƒä»¬çš„å€¼ã€‚
- ç®€æ´: ç›¸æ¯”ä¼ ç»Ÿçš„å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•ï¼ˆå¦‚ % æ“ä½œç¬¦æˆ– str.format() æ–¹æ³•ï¼‰ï¼Œf-string æ›´åŠ ç®€æ´å’Œæ˜“è¯»ã€‚
#### è¯­æ³•
f-string é€šè¿‡åœ¨å­—ç¬¦ä¸²å‰åŠ ä¸€ä¸ªå°å†™å­—æ¯ f æ¥è¡¨ç¤ºã€‚å˜é‡æˆ–è¡¨è¾¾å¼è¢«æ”¾åœ¨å¤§æ‹¬å· {} ä¸­ã€‚è¿™äº›è¡¨è¾¾å¼åœ¨è¿è¡Œæ—¶è¢«è®¡ç®—ï¼Œå¹¶å°†ç»“æœåµŒå…¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚

#### ç¤ºä¾‹
```python
name = "Buddy"
age = 4

#### ä½¿ç”¨ f-string æ ¼å¼åŒ–å­—ç¬¦ä¸²
message = f"{name} is {age} years old."

print(message)  # è¾“å‡º: Buddy is 4 years old.
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š
f: è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆf-stringï¼‰ã€‚
{name}: è¡¨ç¤º name å˜é‡çš„å€¼å°†è¢«æ’å…¥åˆ°è¿™ä¸ªä½ç½®ã€‚
{age}: è¡¨ç¤º age å˜é‡çš„å€¼å°†è¢«æ’å…¥åˆ°è¿™ä¸ªä½ç½®ã€‚

#### å¤æ‚è¡¨è¾¾å¼
f-string è¿˜æ”¯æŒåµŒå…¥æ›´å¤æ‚çš„è¡¨è¾¾å¼å’Œå‡½æ•°è°ƒç”¨ï¼š

```python
import math

radius = 5
area = math.pi * radius ** 2

#### åµŒå…¥è®¡ç®—è¡¨è¾¾å¼
message = f"The area of a circle with radius {radius} is {area:.2f}."

print(message)  # è¾“å‡º: The area of a circle with radius 5 is 78.54.
```
{radius}: ç›´æ¥åµŒå…¥å˜é‡çš„å€¼ã€‚
{area:.2f}: åµŒå…¥è®¡ç®—ç»“æœï¼Œå¹¶æ ¼å¼åŒ–ä¸ºå°æ•°ç‚¹åæœ‰ä¸¤ä½æ•°å­—ã€‚




























































### è¿­ä»£å™¨iter
åœ¨pythonä¸­ç‰¹æœ‰çš„ä¸€ä¸ªå¯¹è±¡.
è¿­ä»£å™¨æ˜¯å®ç°äº† è¿­ä»£å™¨åè®® çš„å¯¹è±¡ï¼Œè¿™æ„å‘³ç€å®ƒå¿…é¡»å®ç°ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼š

- __iter__(): è¯¥æ–¹æ³•è¿”å›è¿­ä»£å™¨å¯¹è±¡æœ¬èº«ã€‚è¿™ä½¿å¾—å¯¹è±¡å¯ä»¥è¢«å¤šæ¬¡éå†ã€‚
- __next__(): è¯¥æ–¹æ³•è¿”å›å®¹å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å½“å®¹å™¨å†…æ²¡æœ‰æ›´å¤šå…ƒç´ æ—¶ï¼Œåº”å½“å¼•å‘ StopIteration å¼‚å¸¸ï¼Œç»“æŸè¿­ä»£.  (å…¶å®next(iterator) å’Œ iterator.__next__() çš„æ•ˆæœæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œéƒ½æ˜¯ä»è¿­ä»£å™¨ä¸­è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚next()æ˜¯pythonçš„å†…ç½®è¿­ä»£å™¨å‡½æ•°.)
- 
- **å¯è¿­ä»£å¯¹è±¡ï¼ˆIterableï¼‰:**

ä»»ä½•å¯ä»¥è¿”å›ä¸€ä¸ªè¿­ä»£å™¨çš„å¯¹è±¡éƒ½ç§°ä¸ºå¯è¿­ä»£å¯¹è±¡ã€‚å¸¸è§çš„å¦‚åˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²ã€å­—å…¸ã€é›†åˆ, è¿˜æœ‰è¿­ä»£å™¨æœ¬èº«ç­‰ã€‚
å¯è¿­ä»£å¯¹è±¡æ‹¥æœ‰ __iter__() æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚
ä¾‹å¦‚:
```python
# åˆ›å»ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ï¼‰
my_list = [1, 2, 3, 4]

# è·å–è¯¥å¯¹è±¡çš„è¿­ä»£å™¨
iterator = iter(my_list)

# ä½¿ç”¨è¿­ä»£å™¨é€ä¸ªè®¿é—®å…ƒç´ 
print(next(iterator))  # è¾“å‡º: 1
print(next(iterator))  # è¾“å‡º: 2
print(next(iterator))  # è¾“å‡º: 3
print(next(iterator))  # è¾“å‡º: 4

# å½“æ²¡æœ‰æ›´å¤šå…ƒç´ æ—¶ï¼Œå†è°ƒç”¨ next() ä¼šå¼•å‘ StopIteration å¼‚å¸¸
# print(next(iterator))  # ä¼šå¼•å‘ StopIteration å¼‚å¸¸
```

- è¿­ä»£å™¨çš„ç‰¹ç‚¹
    - æƒ°æ€§è®¡ç®—:

    è¿­ä»£å™¨ä¼šåœ¨æ¯æ¬¡è°ƒç”¨ next() æ—¶ç”Ÿæˆä¸€ä¸ªå€¼ï¼Œå¹¶ä¸ä¼šåƒåˆ—è¡¨é‚£æ ·ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰å…ƒç´ ï¼Œè¿™ä½¿å¾—è¿­ä»£å™¨ç‰¹åˆ«é€‚åˆç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–æ— é™åºåˆ—ã€‚
    - ä¸€æ¬¡æ€§:

    è¿­ä»£å™¨åœ¨éå†å®Œæˆåä¸èƒ½é‡ç½®æˆ–é‡æ–°å¼€å§‹éå†ã€‚
    - è½»é‡çº§:

è¿­ä»£å™¨åªåœ¨éœ€è¦æ—¶æ‰ç”Ÿæˆå…ƒç´ ï¼Œå› æ­¤å ç”¨çš„å†…å­˜æ¯”åˆ—è¡¨ç­‰æ•°æ®ç»“æ„å°‘ã€‚






## pythoné¡¹ç›®çš„æ¶æ„(ä»¥é¡¹ç›®æ–‡ä»¶å¤¹Aä¸ºä¾‹)
ä¸€ä¸ª(å¯èƒ½æœ‰ä¸¤ä¸‰ä¸ª?)å­æ–‡ä»¶å¤¹(ä¸€èˆ¬ä¹Ÿå«A)é‡Œå­˜äº†å¾ˆå¤š.py, ä¸ºé¡¹ç›®ä¸»ä½“. å¯ä»¥ç†è§£æˆCä¸­çš„å„ç§.c, .hè¦è¢«è°ƒç”¨.
åŒæ—¶è¿˜æœ‰readme, setup.py(å®ƒçš„ä½œç”¨åŒrequirement.txt)
åœ¨å«æœ‰setup.pyçš„ç›®å½•ä¸‹è¿è¡Œ`pip install -e .`. pipå‘½ä»¤è‡ªåŠ¨è¿è¡Œå½“å‰ç›®å½•(`.`)çš„`-editable`(å¼€å‘æ¨¡å¼), â€œå¯ç¼–è¾‘â€æ¨¡å¼çš„æ„æ€æ˜¯ pip å¹¶ä¸æ˜¯æŠŠæºç çš„å‰¯æœ¬å¤åˆ¶åˆ°ä½ çš„ Python åŒ…ç›®å½•ä¸‹ï¼Œè€Œæ˜¯å»ºç«‹ä¸€ä¸ªé“¾æ¥ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥æˆ–å¼•ç”¨ï¼‰ï¼Œç›´æ¥æŒ‡å‘ä½ å½“å‰çš„æºç ç›®å½•ã€‚è¿™æœ‰å‡ ä¸ªå¥½å¤„ï¼š

å³æ—¶æ›´æ–°ï¼š å¦‚æœä½ ä¿®æ”¹äº†æºç ï¼Œè¿™äº›æ”¹åŠ¨ä¼šç«‹åˆ»åœ¨ä½ å®‰è£…çš„åŒ…ä¸­ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¤å®‰è£…ã€‚

å¼€å‘è°ƒè¯•ï¼š å¯¹äºæ­£åœ¨å¼€å‘å’Œè°ƒè¯•ä¸­çš„é¡¹ç›®ï¼Œè¿™ç§æ–¹å¼éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºä½ å¯ä»¥ç›´æ¥ç¼–è¾‘æºç ï¼Œç„¶åè¿è¡Œç¨‹åºçœ‹åˆ°æœ€æ–°æ•ˆæœã€‚


### åŒ…ï¼ˆPackageï¼‰

åŒ…æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„ `__init__.py` æ–‡ä»¶ï¼ˆåœ¨ Python 3.3 ä»¥åå¯ä»¥çœç•¥ï¼Œä½†ä»ç„¶å¸¸ç”¨ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—ã€‚åŒ…å…è®¸ä½ ä»¥å±‚æ¬¡åŒ–çš„æ–¹å¼ç»„ç»‡å’Œç®¡ç†ä»£ç ï¼Œå°±åƒ C è¯­è¨€ä¸­çš„æ–‡ä»¶å¤¹ç»“æ„ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåŒ…å¯èƒ½åŒ…å«å¤šä¸ªç›¸å…³çš„åŠŸèƒ½æ¨¡å—ã€‚

### åº“ï¼ˆLibraryï¼‰ï¼š
åº“é€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªå®Œæ•´çš„ã€æä¾›æŸç§åŠŸèƒ½çš„ä»£ç é›†åˆï¼Œè¿™ä¸ªé›†åˆå¯ä»¥ç”±å¤šä¸ªåŒ…ã€æ¨¡å—ã€å·¥å…·å’Œæ–‡æ¡£ç»„æˆã€‚åº“æ˜¯ä¸€ç§æ›´å¤§çš„æ¦‚å¿µï¼Œå®ƒå¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…ã€‚ä¾‹å¦‚ï¼Œ`numpy` å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåº“ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªæ¨¡å—å’Œå¯èƒ½çš„å­åŒ…ï¼Œæä¾›æ•°å€¼è®¡ç®—åŠŸèƒ½ã€‚

# pytorchæ¡†æ¶

## 1.å¼ é‡

ä¸€ä¸ªshapeä¸º[k1,k2,k3,k4]çš„4ç»´(rank)å¼ é‡
æ•°å­¦æ„ä¹‰ä¸Š, å®ƒä»¬éƒ½æ˜¯æœ‰4ä¸ªä¸‹è§’æ ‡çš„å››ç»´å¼ é‡:
$$x_{abcd}, \\å…¶ä¸­a=1,...,k1; \\b=1,...,k2; \\c=1,...,k3; \\d=1,...,k4.$$

ä¸è¿‡æ³¨æ„äº‹å®ä¸Šç¼–ç¨‹çš„æ—¶å€™æ‰€æœ‰è§’æ ‡éƒ½-1, å› ä¸ºpythonä¸­è§’æ ‡æ˜¯ä»0å¼€å§‹æ•°çš„.

ä¹Ÿå°±æ˜¯è¯´å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ˜ å°„:
$$
    \mathbb{R}^4  \to  \mathbb{R}, \\
    (a,b,c,d,e) \mapsto  x_{abcde}
$$

å…¶ä»£ç è¡¨ç¤ºå¾ˆä¸‘.é‡‡ç”¨åµŒå¥—æ–¹å¼:
tensor(
    [(ç¬¬ä¸€ç»´åº¦)
        [ç¬¬äºŒç»´åº¦
            ...
        ]
    ]
)

ä¾‹å¦‚, ä¸€ä¸ªshapeä¸º[2,1,1,1]çš„å¼ é‡, å®é™…ä¸Šåªæœ‰$x_{1111}å’Œx_{2111}$ä¸¤ä¸ªåˆ†é‡. å³:
```python
[
    [[[x_1111]]]          #1xxx
    [[[x_2222]]]          #2xxx
]
```

åˆå¦‚, ä¸€ä¸ªshapeä¸º[3,2,2,4]çš„å¼ é‡æ ¼å¼:
```python
[
    [
        [[.][.][.][.][.]]

        [[.][.][.][.][.]]       
    ]

    [
        [[.][.][.][.][.]]

        [[.][.][.][.][.]]       
    ]
               
    [
        [[.][.][.][.][.]]

        [[.][.][.][.][.]]       
    ]       
]




## ğŸ§  é¦–å…ˆï¼šâ€œä¿å­˜æ¨¡å‹å‚æ•°â€åˆ°åº•æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ

åœ¨ PyTorch é‡Œï¼Œå½“ä½ è®­ç»ƒä¸€ä¸ªæ¨¡å‹æ—¶ï¼Œå…¶å®ä½ æ˜¯åœ¨ã€Œä¿®æ”¹ã€æ¨¡å‹å†…éƒ¨çš„å‚æ•°ï¼Œè®©å®ƒèƒ½æ›´å¥½åœ°åšå‡ºé¢„æµ‹ã€‚æ¯”å¦‚å·ç§¯æ ¸ã€æƒé‡ã€åç½®é¡¹... éƒ½æ˜¯å‚æ•°ã€‚

è¿™äº›å‚æ•°å°±æ˜¯ä¸€å † **tensorï¼ˆå¼ é‡ï¼‰**ï¼Œä½ å¯ä»¥ç”¨ï¼š

python

CopyEdit

`model.state_dict()`

æ¥è®¿é—®è¿™äº›å‚æ•°ï¼Œçœ‹åˆ°çš„æ˜¯ä¸€ä¸ª `OrderedDict`ï¼Œå½¢å¦‚ï¼š

python

CopyEdit

`OrderedDict([   ('layer1.weight', tensor(...)),   ('layer1.bias', tensor(...)),   ... ])`

ğŸ‘‰ æ‰€ä»¥æ‰€è°“â€œä¿å­˜æ¨¡å‹â€ï¼ŒæŒ‡çš„æ˜¯ï¼š

> æŠŠè¿™äº› **è®­ç»ƒå¥½çš„å‚æ•°ï¼ˆstate\_dictï¼‰** å­˜åˆ°ç£ç›˜ä¸Šï¼Œä»¥åå¯ä»¥åŠ è½½å›æ¥ç»§ç»­ç”¨ã€‚

* * *

## ğŸ“¦ ç¤ºä¾‹ï¼šä¿å­˜ & åŠ è½½æ¨¡å‹å‚æ•°

python

CopyEdit

`# ä¿å­˜ torch.save(model.state_dict(), 'my_model.pth')  # åŠ è½½ model.load_state_dict(torch.load('my_model.pth')) model.eval()  # å¦‚æœæ˜¯æ¨ç†ç”¨ï¼Œè®°å¾—åˆ‡æˆ eval æ¨¡å¼`

* * *

## ğŸ”§ é‚£ä»€ä¹ˆå«åº•å±‚ï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸€æ­¥æ­¥æ‹†ï¼š

### ğŸ§© PyTorch æ¨¡å‹æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ

PyTorch é‡Œçš„æ¨¡å‹é€šå¸¸æ˜¯ç»§æ‰¿ `nn.Module` çš„ä¸€ä¸ªç±»ï¼Œæ¯”å¦‚ï¼š

```python
class MyNet(nn.Module):
    def __init__(self):
        super().__init__()
        self.fc1 = nn.Linear(784, 128)
        self.relu = nn.ReLU()
        self.fc2 = nn.Linear(128, 10)

    def forward(self, x):
        x = self.fc1(x)
        x = self.relu(x)
        return self.fc2(x)
```
è¿™ä¸ª `MyNet` å…¶å®æ˜¯ä¸€ä¸ª **æœ‰ç»“æ„çš„è®¡ç®—å›¾å®¹å™¨**ï¼Œå®ƒï¼š

-   åŒ…å«äº†ä¸€å †ã€Œæ¨¡å—ã€(æ¯”å¦‚ Linear, ReLU)
    
-   æ¯ä¸ªæ¨¡å—æœ‰å‚æ•° (æ¯”å¦‚æƒé‡ weightã€åç½® bias)
    
-   æ‰€æœ‰å‚æ•°éƒ½è¢«è®°å½•åœ¨ `state_dict` ä¸­
    

* * *

## 2.æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½

### ä¿å­˜: `torch.save(my_model.state_dict(), 'model_weights.pt')`

å¯¹äºä¸€ä¸ªæ¨¡å‹å®ä¾‹, æ¯”å¦‚

```python
class UNet(nn.net)

my_model = UNet(parameters...)
```

`my_model.state_dict()` æ–¹æ³•è¿”å›ä¸€ä¸ªå­—å…¸, åŒ…å«è¯¥æ¨¡å‹ä¸­æ‰€æœ‰å‚æ•°(æƒé‡w+åç½®b).
`torch.save`æ–¹æ³•ç”¨äºä¿å­˜è¿™ä¸ªå‚æ•°æ–‡ä»¶.

```python
torch.save(my_model.state_dict(), 'model_weights.pt')
```
è¯¥å‘½ä»¤å°†ä½ çš„æ¨¡å‹çš„å‚æ•°å­—å…¸ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œä¿å­˜åœ¨æ–‡ä»¶ model_weights.pt ä¸­ã€‚

### åŠ è½½: `my_model.load_state_dict(model_weights)`

å…ˆä½¿ç”¨.loadæ–¹æ³•:
```python
model_weights = torch.load('model_weights.pt', map_location=device)
```
å…ˆä½¿ç”¨è¯¥å‘½ä»¤, å°†æƒé‡æ–‡ä»¶`model_weights.pt`ä¸­çš„å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡`model_weights`ä¸­ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚ 

å…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°map_locationç”¨æ¥æ§åˆ¶åŠ è½½æ—¶å°†æ¨¡å‹æƒé‡åŠ è½½åˆ°å“ªä¸ªè®¾å¤‡ä¸Šã€‚å¦‚æœæ˜¯GPU, é‚£éº½è¿™ä¸ªå˜é‡`model_weights`çš„åœ°å€åœ¨æ˜¾å­˜ä¸Š.


ç„¶åä½¿ç”¨.load_state_dictæ–¹æ³•:
```python
my_model.load_state_dict(model_weights)
```
è¯¥å‘½ä»¤å°†`my_model`æ¨¡å‹çš„å‚æ•°ç”¨`model_weights`åŠ è½½. `.load_state_dict`ä¼šæ£€æŸ¥æ¨¡å‹ä¸­æ¯ä¸ªå‚æ•°åï¼Œå¹¶å°†å¯¹åº”çš„æƒé‡è½½å…¥åˆ°æ­£ç¡®çš„å‚æ•°ä½ç½®ã€‚å¦‚æœæ¨¡å‹çš„ç»“æ„å®Œå…¨åŒ¹é…ï¼Œå°±ä¼šæˆåŠŸåº”ç”¨è¿™äº›å‚æ•°ã€‚å¦‚æœæœ‰ä¸åŒ¹é…çš„å‚æ•°ï¼ˆä¾‹å¦‚æ¨¡å‹ç»“æ„æ”¹å˜äº†ï¼‰ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚



### âœ… `model.state_dict()`ï¼š

-   è¿”å›æ¨¡å‹ä¸­æ‰€æœ‰çš„ **è®­ç»ƒå‚æ•° + bufferå€¼**ï¼ˆåŒ…æ‹¬ `register_buffer` æ³¨å†Œçš„ï¼‰
    

æ¯”å¦‚ï¼š

```python
net = nn.Linear(3, 1)
print(net.state_dict())
# OrderedDict([('weight', tensor([...])), ('bias', tensor([...]))])
```

### âœ… `model.load_state_dict(...)`ï¼š

-   æŠŠä¿å­˜å¥½çš„å‚æ•°é‡æ–°ã€Œå¡å›ã€æ¨¡å‹é‡Œã€‚
    

* * *

## ğŸ¤– é‚£ä¹ˆè®­ç»ƒå‡½æ•°å’Œä¿å­˜æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ

ä½ è®­ç»ƒçš„è¿‡ç¨‹åªæ˜¯ï¼š

> ç”¨æ•°æ®æ›´æ–° `model.parameters()` ä¸­çš„å€¼

è€Œä¿å­˜æ¨¡å‹æ˜¯ï¼š

> æŠŠå½“å‰ `parameters()` çš„å€¼å†™è¿›æ–‡ä»¶ã€‚

æ¯”å¦‚ä½ è®­ç»ƒå®Œä¸€è½®åè¿™æ ·å†™ï¼š

python

CopyEdit

`train_one_epoch(...) torch.save(model.state_dict(), 'after_one_epoch.pth')`

* * *

## âœ¨ BONUSï¼šä¸ºä»€ä¹ˆéœ€è¦ `register_buffer()`ï¼Ÿ

å› ä¸ºä¸æ˜¯æ‰€æœ‰é‡è¦çš„æ•°æ®éƒ½è¦è®­ç»ƒï¼Œæ¯”å¦‚ï¼š

-   æ‰©æ•£è¿‡ç¨‹ä¸­çš„ `alphas_bar`
    
-   BatchNorm çš„ running mean è¿™äº›å˜é‡ä¸è®­ç»ƒï¼Œä½†éœ€è¦è¢«ä¿å­˜ï¼ˆstate\_dict é‡Œä¹Ÿèƒ½æ‰¾åˆ°å®ƒä»¬ï¼ï¼‰





#